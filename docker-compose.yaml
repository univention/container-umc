---

version: '3.8'

name: "dev-local"

services:
  umc-gateway:
    env_file: .env.univention-management-console-gateway
    platform: linux/amd64
    ports:
      - 8110:80

  umc-server:
    env_file: .env.univention-management-console-server
    platform: linux/amd64
    ports:
      - 8111:8090
    volumes:
      - umc-acls:/var/cache/univention-management-console/acls/
    secrets:
      - ca_cert
      - cert_pem
      - private_key

  # Environment of the pre-commit linter.
  pre-commit:
    profiles:
      - test
    image: gitregistry.knut.univention.de/univention/customers/dataport/upx/container-pre-commit/upx-pre-commit:latest
    volumes:
      - type: bind
        source: .
        target: /code
      - type: volume
        # pre-commit installs dependencies, having them cached speeds things up
        # a lot.
        source: pre-commit-cache
        target: /cache

secrets:
  ca_cert:
    file: ssl/certs/CAcert.pem
  cert_pem:
    file: ssl/certs/cert.pem
  private_key:
    file: ssl/secret/private.key

volumes:
  pre-commit-cache:
  umc-acls:


...
